<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vault X — Virtual Card</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0b0f15;
      --panel: #0e1420;
      --panel-2: #0b101b;
      --card: #111827;
      --line: rgba(255,255,255,0.08);
      --border: rgba(255,255,255,0.12);
      --text: #e6e9ef;
      --muted: #93a0b3;
      --primary: #6d5efc;
      --primary-2: #5a7bff;
      --success: #22c55e;
      --danger: #ef4444;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial;
      color: var(--text);
      background: radial-gradient(120% 120% at 0% 0%, rgba(109,94,252,0.12) 0%, rgba(109,94,252,0) 40%), linear-gradient(180deg, #0a0f17, #06090f 70%);
    }

    .frame { min-height: 100%; padding: 28px 18px 28px; display:flex; justify-content:center; }
    .container { width: 960px; max-width: 96vw; }

    .title { font-size: clamp(26px, 6vw, 40px); font-weight: 800; margin: 6px 0 16px; letter-spacing:.3px; }

    .panel { background: #ffffff; color: #0b0f15; border-radius: 14px; padding: 16px; width: 640px; max-width: 100%; margin: 0 auto; }
    .label { font-weight:700; margin: 12px 0 6px; color:#0b0f15; }
    .input, .select { width:100%; padding:14px 16px; border-radius:10px; border:1px solid #d8dde6; background:#f6f7fb; color:#0b0f15; font-family: inherit; }
    .btn { margin-top: 16px; width: 100%; padding: 14px 16px; border-radius: 12px; border: none; cursor: pointer; color: white; background: linear-gradient(90deg, #1f2937, #111827); font-weight: 800; }

    .note { text-align:center; color:#ef4444; font-weight:700; margin: 14px 0; }

    .card-preview { background:#0c0f16; border:1px solid var(--line); border-radius: 16px; padding: 16px; width: 100%; max-width: 960px; margin: 0 auto 18px; display:grid; place-items:center; }
    /* ATM/ID-1 size aspect ratio: 85.6mm × 53.98mm ≈ 1.586 */
    .vc { background:#1f2430; border-radius:16px; color:#e5e7eb; position: relative; overflow: hidden; width: clamp(280px, 90vw, 560px); aspect-ratio: 85.6 / 54; padding: 26px 20px 20px; }
    .vc .row { display:flex; align-items:center; justify-content:space-between; gap: 12px; }
    .vc .brand { display:flex; align-items:center; gap:10px; }
    .vc .logo { width:22px; height:22px; border-radius:8px; background: linear-gradient(180deg, #6d5efc, #5a7bff); display:grid; place-items:center; box-shadow: 0 6px 16px rgba(109,94,252,.35); }
    .vc .logo img { width:16px; height:16px; display:block; }
    .brandbar img { width:20px; height:20px; display:block; }
    #downloadCardBtn { width: auto; display: block; margin: 10px auto 0; padding: 10px 16px; max-width: none; }
    .vc .chip { width:70px; height:28px; border-radius:999px; background:linear-gradient(180deg,#c8ccd6,#f1f3f7); color:#0b0f15; display:grid; place-items:center; font-weight:800; font-size:11px; letter-spacing:.3px; border:1px solid rgba(0,0,0,.12); }
    .vc .mc { position:absolute; right:-8%; top:-18%; width:60%; height:120%; border-radius:999px; background: radial-gradient(circle at 35% 35%, rgba(109,94,252,.45), rgba(90,123,255,.35) 60%, transparent 61%); }
    .vc .mc::after { content:''; position:absolute; left:-26%; top:22%; width:60%; height:60%; border-radius:999px; background: radial-gradient(circle at 60% 60%, rgba(90,123,255,.45), rgba(109,94,252,.35) 60%, transparent 61%); mix-blend-mode: screen; }
    .vc .num { letter-spacing: 0.22em; font-weight: 800; font-size: clamp(18px, 4.2vw, 24px); margin: 1.1em 0 0.6em; }
    .vc .meta { display:flex; gap: 1.2em; opacity:.85; font-size: clamp(11px, 2.8vw, 14px); margin-top: 3.2em; }

    /* Responsive */
    @media (max-width: 560px){
      .frame { padding: 18px 12px 18px; }
      .card-preview { padding: 12px; }
      .vc { padding: 20px 16px 16px; }
      .vc .chip { width:40px; height:40px; font-size:16px; }
    }
    @media (max-height: 560px){
      .frame { min-height: auto; padding-top: 16px; }
    }
  </style>
</head>
<body>
  <div class="frame">
    <div class="container">
      <div class="brandbar"><img src="favicon.svg" alt="Vault X"/><div class="name">Vault X</div></div>
      <div class="card-preview">
        <div class="vc" id="vcRoot">
          <div class="mc"></div>
          <div class="row">
            <div class="brand"><div class="logo"><img src="favicon.svg" alt="VX"/></div><div style="font-weight:800; letter-spacing:.2px;">VAULT X</div></div>
            <div class="chip">VIRTUAL</div>
          </div>
          <div class="num" id="vcNum">**** **** **** ****</div>
          <div class="meta">
            <div><div style="opacity:.7;">cardholder name</div><div style="font-weight:800;" id="vcName">**MASTER  CARD**</div></div>
            <div><div style="opacity:.7;">expiration</div><div style="font-weight:800;" id="vcExp">0*/**</div></div>
            <div><div style="opacity:.7;">cvv</div><div style="font-weight:800;" id="vcCvv">***</div></div>
          </div>
        </div>
      </div>
      <button class="btn" id="downloadCardBtn">Download Card</button>
    </div>
  </div>

  <script>
    (function hydrateCard(){
      const num = (localStorage.getItem('eqx_card_number') || '').trim();
      const name = (localStorage.getItem('eqx_card_name') || '').trim();
      const exp = (localStorage.getItem('eqx_card_exp') || '').trim();
      const cvv = (localStorage.getItem('eqx_card_cvv') || '').trim();

      const numEl = document.getElementById('vcNum');
      const nameEl = document.getElementById('vcName');
      const expEl = document.getElementById('vcExp');
      const cvvEl = document.getElementById('vcCvv');

      if (numEl) {
        const sanitized = num.replace(/[^0-9]/g,'').slice(0,16);
        if (sanitized) {
          const blocks = sanitized.match(/.{1,4}/g) || [];
          numEl.textContent = blocks.join(' ');
        }
      }
      if (nameEl && name) nameEl.textContent = name.toUpperCase();
      if (expEl && exp) expEl.textContent = exp;
      if (cvvEl && cvv) cvvEl.textContent = cvv;
    })();

    // Download card as image
    (function enableDownload(){
      const btn = document.getElementById('downloadCardBtn');
      const root = document.getElementById('vcRoot');
      if (!btn || !root) return;
      btn.addEventListener('click', async function(){
        try {
          // Ensure html2canvas loaded; load from CDN if missing
          async function ensureHtml2Canvas(){
            if (window.html2canvas) return true;
            await new Promise(function(resolve, reject){
              const s = document.createElement('script');
              s.src = 'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js';
              s.onload = resolve; s.onerror = reject; document.head.appendChild(s);
            });
            return !!window.html2canvas;
          }

          if (await ensureHtml2Canvas()) {
            const canvas = await window.html2canvas(root, { backgroundColor: null, scale: 2 });
            const link = document.createElement('a');
            link.download = 'vaultx-card.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
            return;
          }
          // Lightweight SVG serialization fallback
          const svg = new Blob([
            '<svg xmlns="http://www.w3.org/2000/svg" width="' + root.offsetWidth + '" height="' + root.offsetHeight + '">'
            + '<foreignObject width="100%" height="100%">'
            + new XMLSerializer().serializeToString(root)
            + '</foreignObject></svg>'
          ], { type: 'image/svg+xml;charset=utf-8' });
          const url = URL.createObjectURL(svg);
          const img = new Image();
          img.onload = function(){
            const canvas = document.createElement('canvas');
            canvas.width = root.offsetWidth * 2; canvas.height = root.offsetHeight * 2;
            const ctx = canvas.getContext('2d');
            ctx.scale(2,2);
            ctx.drawImage(img, 0, 0);
            URL.revokeObjectURL(url);
            const link = document.createElement('a');
            link.download = 'vaultx-card.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
          };
          img.src = url;
        } catch (e) {
          console.error('Failed to download card', e);
          alert('Download failed. Please try a screenshot as a fallback.');
        }
      });
    })();
  </script>
</body>
</html>
